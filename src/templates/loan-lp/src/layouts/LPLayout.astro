---
interface Props {
  title: string;
  description: string;
  canonical?: string;
  conversionId?: string;
  formStartLabel?: string;
  formSubmitLabel?: string;
  voluumDomain?: string;
  companyName?: string;
}

const {
  title,
  description,
  canonical,
  conversionId = '',
  formStartLabel = '',
  formSubmitLabel = '',
  voluumDomain = '',
  companyName = '',
} = Astro.props;

const canonicalUrl = canonical || Astro.url.href;
---

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <meta name="theme-color" content="#3b5998" />
  <meta name="color-scheme" content="light" />
  <meta name="robots" content="noindex, nofollow" />
  <title>{title}</title>
  <link rel="canonical" href={canonicalUrl} />

  <!-- Font preload -->
  <link rel="preload" href="/fonts/InterVariable.woff2" as="font" type="font/woff2" crossorigin />

  {voluumDomain && (
    <>
      <link rel="dns-prefetch" href={`https://${voluumDomain}`} />
      <link rel="preconnect" href={`https://${voluumDomain}`} crossorigin />
    </>
  )}

  <!-- Layer 1: gtag.js â€” Google Ads conversion only -->
  {conversionId && (
    <>
      <script async src={`https://www.googletagmanager.com/gtag/js?id=${conversionId}`}></script>
      <script is:inline define:vars={{ conversionId }}>
        window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config',conversionId);
      </script>
    </>
  )}

  <style is:global>
    @import '../styles/globals.css';
  </style>

  {voluumDomain && (
    <script is:inline define:vars={{ voluumDomain }}>
      (function(){ var i = new Image(1,1); i.src = 'https://' + voluumDomain + '/impression?'; })();
    </script>
  )}
</head>
<body class="min-h-screen flex flex-col">
  <!-- Expose tracking config to client -->
  <script is:inline define:vars={{ conversionId, formStartLabel, formSubmitLabel }}>
    window.__CONVERSION_ID__=conversionId;window.__FORM_START_LABEL__=formStartLabel;window.__FORM_SUBMIT_LABEL__=formSubmitLabel;
  </script>

  <!-- Layer 2: First-party pixel (sendBeacon to t.{domain}/e) -->
  <script is:inline>
    (function(){
      var PX='https://t.'+window.location.hostname+'/e';
      var sid=crypto.randomUUID();
      var up=new URLSearchParams(window.location.search);
      var cid=up.get('clickid')||up.get('click_id')||up.get('cid')||'';
      var gid=up.get('gclid')||'';
      if(cid)sessionStorage.setItem('click_id',cid);
      if(gid)sessionStorage.setItem('gclid',gid);
      ['utm_source','utm_medium','utm_campaign','utm_term','utm_content'].forEach(function(k){var v=up.get(k);if(v)sessionStorage.setItem(k,v);});
      function fire(e,d){var p=new URLSearchParams({e:e,sid:sid,cid:cid,gid:gid,ts:Date.now(),url:window.location.pathname,ref:document.referrer});if(d)for(var k in d)p.set(k,d[k]);try{navigator.sendBeacon(PX,p);}catch(x){}}
      window.__pixel=fire;
      fire('pv',{ua:navigator.userAgent,sw:screen.width,sh:screen.height});
      var sf={};window.addEventListener('scroll',function(){var h=document.documentElement.scrollHeight-window.innerHeight;if(h<=0)return;var pct=Math.round(window.scrollY/h*100);[25,50,75,100].forEach(function(t){if(pct>=t&&!sf[t]){sf[t]=true;fire('s'+t);}});},{passive:true});
      setTimeout(function(){fire('t30');},30000);setTimeout(function(){fire('t60');},60000);
    })();
  </script>

  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 bg-primary text-primary-foreground px-4 py-2 rounded-md font-medium">
    Skip to content
  </a>

  <main id="main-content" class="flex-1">
    <slot />
  </main>

  <slot name="footer" />
</body>
</html>
